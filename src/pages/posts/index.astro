---
import { getCollection } from 'astro:content';
import { SITE } from '../../consts';
import Base from '../../layouts/Base.astro';
import PostCard from '../../components/PostCard.astro';

const posts = (await getCollection('posts', ({ data }) => {
    if (import.meta.env.PROD) return !data.draft;
    return true;
  }))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<Base title="Blog" description={`All posts from ${SITE.title}.`}>
  <div class="mx-auto max-w-3xl px-6 pt-16 pb-12">
    <header class="mb-12">
      <h1 class="text-4xl sm:text-5xl font-bold leading-tight tracking-tight mb-4">
        All Posts
      </h1>
      <p class="font-(family-name:--font-ui) text-sm text-(--color-muted)">
        {posts.length} articles
      </p>
    </header>

    <div class="divide-y divide-(--color-border)">
      {posts.map((post) => (
        <PostCard
          title={post.data.title}
          description={post.data.description}
          date={post.data.date}
          slug={post.id}
          tags={post.data.tags}
        />
      ))}
    </div>
  </div>
</Base>
