---
import { getCollection } from 'astro:content';
import { Icon } from 'astro-icon/components';
import { SITE, SOCIAL } from '../consts';
import Base from '../layouts/Base.astro';

const posts = (await getCollection('posts', ({ data }) => {
    if (import.meta.env.PROD) return !data.draft;
    return true;
  }))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);
---

<Base title="Home" description={SITE.description}>
  <section class="relative isolate overflow-hidden">
    <div class="mx-auto max-w-3xl px-6 min-h-[calc(100svh-4.5rem)] py-10">
      <div class="min-h-[calc(100svh-4.5rem-5rem)] flex flex-col items-start justify-center w-full">
        <div class="animate-fade-up">
          <p class="font-(family-name:--font-ui) text-xs tracking-widest uppercase text-(--color-muted) mb-5">
            Welcome
          </p>
          <h1 class="text-5xl sm:text-6xl lg:text-7xl font-bold leading-[1.05] tracking-tight mb-6">
            I'm Graham
          </h1>
          <p class="font-(family-name:--font-body) text-xl text-(--color-muted) leading-relaxed max-w-xl mb-8">
            Sharing essays and experiments from building systems in mission-driven orgs.
          </p>
          <div class="flex items-center gap-3">
            <a href="/posts" class="link-organic font-(family-name:--font-ui) text-sm font-medium tracking-wide text-(--color-accent-interactive)">
              Read the blog
            </a>
            <span class="text-(--color-border)">&middot;</span>
            <a href="/about" class="link-organic font-(family-name:--font-ui) text-sm font-medium tracking-wide text-(--color-muted) hover:text-(--color-text)">
              About me
            </a>
          </div>
        </div>

        <div class="mt-[clamp(3rem,8vh,6rem)] w-full animate-fade-up" style="animation-delay: 0.15s;">
          <div>
            <div class="flex items-baseline justify-between gap-4 mb-6">
              <h2 class="font-(family-name:--font-ui) text-xs uppercase tracking-widest text-(--color-muted)">
                Recent posts
              </h2>
              <a href="/posts" class="link-organic font-(family-name:--font-ui) text-sm font-medium text-(--color-accent-interactive)">
                View all
              </a>
            </div>
            <ul class="m-0 p-0 list-none text-left">
              {posts.map((post) => (
                <li class="py-4 -mx-2 px-2 rounded group transition-colors duration-300 hover:bg-(--color-surface)">
                  <a
                    href={`/posts/${post.id}`}
                    class="flex items-baseline justify-between gap-4 no-underline"
                  >
                    <span class="min-w-0 font-(family-name:--font-headline) text-lg sm:text-xl font-medium leading-snug text-(--color-text) group-hover:text-(--color-accent-interactive) transition-colors duration-300 line-clamp-1">
                      {post.data.title}
                    </span>
                    <time
                      datetime={post.data.date.toISOString()}
                      class="shrink-0 font-(family-name:--font-ui) text-xs sm:text-sm text-(--color-muted) tracking-wide"
                    >
                      {post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
                    </time>
                  </a>
                </li>
              ))}
            </ul>
          </div>
        </div>

        <nav aria-label="Social links" class="mt-10 flex items-center gap-5 animate-fade-up" style="animation-delay: 0.3s;">
          {SOCIAL.map((link) => (
            <a
              href={link.url}
              target="_blank"
              rel="noopener noreferrer"
              aria-label={link.name}
              class="text-(--color-muted) hover:text-(--color-accent-interactive) transition-colors duration-300"
            >
              <Icon name={link.icon} class="size-5" />
            </a>
          ))}
        </nav>
      </div>
    </div>
  </section>
</Base>
